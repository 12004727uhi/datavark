{% extends "base.html" %}
{% load static %}
{% block title %}Scheduler{%endblock%}
{% block stylesheets %}
<link rel="stylesheet" href="{% static 'css/ie_style.css' %}" />{% endblock %}
{% block content %}
<h1>Data acquisition scheduler</h1>
<div id="schedule-table">
    {% load render_table from django_tables2 %}
    {% autoescape off %}
    {% render_table schedule_table %}
    {% endautoescape %}
</div>
<div id="results-table">
    {% load render_table from django_tables2 %}
    {% autoescape off %}
    {% render_table results_table %}
    {% endautoescape %}
</div>
<div>
    <form id="schedule-form">
        {% csrf_token %}
        {% for field in form %}
        <div class="form-group col-4">
            <label class="col-8">{{ field.label }}</label>
            <span class="col-4">{{ field }}</span>
        </div>
        {% endfor %}
        <!-- <input type="submit" class="btn btn-primary" value="Change Scheduled" /> -->
        <form>
</div>
{% endblock %}
{% block javascript %}
<script type="text/javascript">
    $(document).ready(() => {
        {% for source in sources %}
        $('#id_{{source}}').click(() => {
            let formData = $('#schedule-form').serialize();
            console.log('Posting: ', formData);
            $.ajax({
                url: "{% url 'ie:index' %}",
                data: formData,
                type: 'POST',
                dataType: 'json',
                success: (response) => {
                    console.log(response.status_report)
                    window.location.href = "/ie/"
                },
                error: (response) => {
                    console.log(response.status_report);
                }
            });
        });
        {% endfor %}
    });
</script>
{% endblock %}